<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CBT Platform</title>
    <link rel="icon" href="images/fav1.jpeg" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">MyCBT - Admin</div>
            <div class="user-info">
                <span id="user-name">Welcome, Admin</span>
                <script>
                    (function() {
                        const username = localStorage.getItem('username');
                        if (username) {
                            document.getElementById('user-name').textContent = 'Welcome, ' + username;
                        }
                    })();
                </script>
                <button onclick="logout()">Logout</button>
            </div>
        </nav>
    </header>

    <main class="admin-dashboard">
        <div class="container">
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('subjects')">Subjects</button>
                <button class="tab-btn" onclick="showTab('questions')">Questions</button>
                <button class="tab-btn" onclick="showTab('users')">Users</button>
                <button class="tab-btn" onclick="showTab('news')">News</button>
            </div>

            <!-- Subjects Tab -->
            <div id="subjects-tab" class="tab-content active">
                <h2>Manage Subjects</h2>
                <form id="subject-form" onsubmit="addSubject(event)">
                    <div class="form-group">
                        <label for="subject-name">Subject Name:</label>
                        <input type="text" id="subject-name" placeholder="e.g. Mathematics, English" required>
                    </div>
                    <div class="form-group">
                        <label for="subject-description">Description:</label>
                        <textarea id="subject-description" required></textarea>
                    </div>
                    <button type="submit" class="admin-btn">Add Subject</button>
                </form>
                <div id="subjects-list" class="admin-list"></div>
            </div>

            <!-- Questions Tab -->
            <div id="questions-tab" class="tab-content">
                <h2>Manage Questions</h2>
                <form id="question-form" onsubmit="addQuestion(event)">
                    <div class="form-group">
                        <label for="question-exam-type">Exam Type:</label>
                        <select id="question-exam-type" required>
                            <option value="">Select Exam Type</option>
                            <option value="NECO">NECO</option>
                            <option value="WAEC">WAEC</option>
                            <option value="JAMB">JAMB</option>
                            <option value="NABTEB">NABTEB</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="question-subject">Subject:</label>
                        <select id="question-subject" required>
                            <option value="">Select Subject</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="question-text">Question Text (Optional):</label>
                        <textarea id="question-text" placeholder="Enter question text"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="question-image">Question Image (Optional):</label>
                        <input type="file" id="question-image" accept="image/*" onchange="previewQuestionImage(event, 'question-preview')">
                        <div id="question-preview" class="image-preview"></div>
                    </div>
                    <div class="form-group">
                        <label for="question-explanation">Explanation (Text):</label>
                        <textarea id="question-explanation" placeholder="Explain the correct answer"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="explanation-image">Explanation (Image - Optional):</label>
                        <input type="file" id="explanation-image" accept="image/*" onchange="previewExplanationImage(event, 'explanation-preview')">
                        <div id="explanation-preview" class="image-preview"></div>
                    </div>
                    <div class="form-group">
                        <label for="question-type">Question Type:</label>
                        <select id="question-type" required>
                            <option value="multiple_choice">Multiple Choice</option>
                            <option value="true_false">True/False</option>
                            <option value="short_answer">Short Answer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="option-a">Option A:</label>
                        <input type="text" id="option-a" required>
                    </div>
                    <div class="form-group">
                        <label for="option-b">Option B:</label>
                        <input type="text" id="option-b" required>
                    </div>
                    <div class="form-group">
                        <label for="option-c">Option C:</label>
                        <input type="text" id="option-c" required>
                    </div>
                    <div class="form-group">
                        <label for="option-d">Option D:</label>
                        <input type="text" id="option-d" required>
                    </div>
                    <div class="form-group">
                        <label for="correct-answer">Correct Answer:</label>
                        <input type="text" id="correct-answer" required>
                    </div>

                    <button type="submit" class="admin-btn">Add Question</button>
                </form>
                <div id="questions-list" class="admin-list"></div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <h2>Manage Users</h2>
                <div id="users-list" class="admin-list"></div>
            </div>

            <!-- News Tab -->
            <div id="news-tab" class="tab-content">
                <h2>Manage News</h2>
                <form id="news-form" onsubmit="addNews(event)">
                    <div class="form-group">
                        <label for="news-title">News Title:</label>
                        <input type="text" id="news-title" placeholder="Enter news headline" required maxlength="500">
                    </div>
                    <div class="form-group">
                        <label for="news-content">News Content:</label>
                        <textarea id="news-content" placeholder="Enter a brief description of the news" required rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="news-url">Article URL:</label>
                        <input type="url" id="news-url" placeholder="https://example.com/full-article" required>
                        <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.3rem;">
                            The full URL where readers can read the complete article
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="news-date">Publication Date:</label>
                        <input type="datetime-local" id="news-date" required>
                    </div>
                    <button type="submit" class="admin-btn">Add News</button>
                </form>
                <div id="news-list" class="admin-list"></div>
            </div>
        </div>
    </main>

    <!-- Edit News Modal -->
    <div id="edit-news-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <h3>Edit News</h3>
            <form id="edit-news-form" onsubmit="updateNews(event)">
                <input type="hidden" id="edit-news-id">
                <div class="form-group">
                    <label for="edit-news-title">News Title:</label>
                    <input type="text" id="edit-news-title" required maxlength="500">
                </div>
                <div class="form-group">
                    <label for="edit-news-content">News Content:</label>
                    <textarea id="edit-news-content" required rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-news-url">Article URL:</label>
                    <input type="url" id="edit-news-url" required>
                </div>
                <div class="form-group">
                    <label for="edit-news-date">Publication Date:</label>
                    <input type="datetime-local" id="edit-news-date" required>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="admin-btn">Update News</button>
                    <button type="button" onclick="closeEditNewsModal()" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Question Modal -->
    <div id="edit-question-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <h3>Edit Question</h3>
            <form id="edit-question-form" onsubmit="updateQuestion(event)">
                <input type="hidden" id="edit-question-id">
                <div class="form-group">
                    <label for="edit-question-exam-type">Exam Type:</label>
                    <select id="edit-question-exam-type" required>
                        <option value="NECO">NECO</option>
                        <option value="WAEC">WAEC</option>
                        <option value="JAMB">JAMB</option>
                        <option value="NABTEB">NABTEB</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-question-subject">Subject:</label>
                    <select id="edit-question-subject" required>
                        <option value="">Select Subject</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-question-text">Question Text (Optional):</label>
                    <textarea id="edit-question-text" placeholder="Enter question text"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-question-image">Question Image (Optional):</label>
                    <input type="file" id="edit-question-image" accept="image/*" onchange="previewQuestionImage(event, 'edit-question-preview')">
                    <div id="edit-question-preview" class="image-preview"></div>
                    <div id="edit-current-question-image"></div>
                </div>
                <div class="form-group">
                    <label for="edit-question-explanation">Explanation (Text):</label>
                    <textarea id="edit-question-explanation"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-explanation-image">Explanation (Image - Optional):</label>
                    <input type="file" id="edit-explanation-image" accept="image/*" onchange="previewExplanationImage(event, 'edit-explanation-preview')">
                    <div id="edit-explanation-preview" class="image-preview"></div>
                    <div id="edit-current-explanation-image"></div>
                </div>
                <div class="form-group">
                    <label for="edit-option-a">Option A:</label>
                    <input type="text" id="edit-option-a" required>
                </div>
                <div class="form-group">
                    <label for="edit-option-b">Option B:</label>
                    <input type="text" id="edit-option-b" required>
                </div>
                <div class="form-group">
                    <label for="edit-option-c">Option C:</label>
                    <input type="text" id="edit-option-c" required>
                </div>
                <div class="form-group">
                    <label for="edit-option-d">Option D:</label>
                    <input type="text" id="edit-option-d" required>
                </div>
                <div class="form-group">
                    <label for="edit-correct-answer">Correct Answer:</label>
                    <input type="text" id="edit-correct-answer" required>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="admin-btn">Update Question</button>
                    <button type="button" onclick="closeEditModal()" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/custom-alert.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin-dashboard.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
        });
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'questions') {
                loadQuestions();
            } else if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'subjects') {
                loadSubjects();
            } else if (tabName === 'news') {
                loadNews();
            }
        }
    </script>
</body>
</html>